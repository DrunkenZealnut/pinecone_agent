<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ config.title }} - Pinecone Agent</title>
    <style>
        :root {
            --primary-color: {{ config.color }};
            --primary-rgb: {{ config.color_rgb }};
            --gradient-from: {{ config.gradient_from }};
            --gradient-to: {{ config.gradient_to }};
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Navigation */
        nav {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        nav a {
            color: #888;
            text-decoration: none;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--primary-color);
        }

        nav .current {
            color: var(--primary-color);
            font-weight: bold;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
        }

        /* Search Panel */
        .search-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            height: fit-content;
        }

        .search-panel h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: #aaa;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px 15px;
            color: #e0e0e0;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn-search {
            background: linear-gradient(135deg, var(--gradient-from), var(--gradient-to));
            border: none;
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-search:hover {
            transform: translateY(-2px);
        }

        .btn-search:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Results Panel */
        .results-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-header h2 {
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .result-count {
            color: #888;
            font-size: 0.9rem;
        }

        /* Search Results List */
        .search-results {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .result-item.selected {
            border-color: var(--primary-color);
            background: rgba(var(--primary-rgb), 0.1);
        }

        .result-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
            margin-bottom: 8px;
        }

        .result-info {
            display: flex;
            gap: 15px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .result-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Detail View */
        .detail-view {
            margin: 20px 0;
            display: none;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            padding: 30px;
        }

        .detail-view.active {
            display: block;
        }

        /* Other Results Section */
        .other-results {
            margin-top: 30px;
        }

        .other-results-header {
            color: var(--primary-color);
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-left: 5px;
        }

        .detail-header {
            background: linear-gradient(135deg, var(--gradient-from), var(--gradient-to));
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .detail-header h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .detail-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            opacity: 0.9;
        }

        /* Summary Cards */
        .summary-section {
            margin-bottom: 30px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
        }

        .summary-card-title {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-card-content {
            color: #ccc;
            line-height: 1.6;
        }

        .summary-card-content strong {
            color: #fff;
            display: block;
            margin-top: 8px;
        }

        .summary-highlight {
            background: rgba(var(--primary-rgb), 0.2);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid var(--primary-color);
            margin-top: 10px;
        }

        /* Detail Sections - Accordion Style */
        .detail-sections {
            margin-top: 30px;
        }

        .detail-sections h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .accordion-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .accordion-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .accordion-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .accordion-header.active {
            background: rgba(var(--primary-rgb), 0.1);
        }

        .accordion-title {
            color: #fff;
            font-weight: 500;
        }

        .accordion-icon {
            color: var(--primary-color);
            transition: transform 0.3s;
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .accordion-content.active {
            max-height: 2000px;
        }

        .accordion-body {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-item {
            margin-bottom: 20px;
        }

        .section-item-name {
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 8px;
        }

        .section-item-detail {
            color: #ccc;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        /* Camera Section */
        .camera-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-camera {
            background: linear-gradient(135deg, var(--gradient-from), var(--gradient-to));
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-size: 0.95rem;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            width: 100%;
        }

        .btn-camera:hover {
            transform: translateY(-2px);
        }

        .btn-camera:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .camera-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .camera-modal.active {
            display: flex;
        }

        .camera-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
        }

        .camera-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .camera-header h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .btn-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .camera-view {
            position: relative;
            width: 100%;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        #videoElement, #canvasElement {
            width: 100%;
            display: block;
        }

        #canvasElement {
            display: none;
        }

        .camera-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-capture, .btn-retake, .btn-identify {
            background: linear-gradient(135deg, var(--gradient-from), var(--gradient-to));
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-capture:hover, .btn-retake:hover, .btn-identify:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(var(--primary-rgb), 0.3);
        }

        .btn-retake {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-retake:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .camera-status {
            text-align: center;
            margin-top: 15px;
            color: #888;
            font-size: 0.9rem;
        }

        .camera-status.identifying {
            color: var(--primary-color);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .search-panel {
                margin-bottom: 20px;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }

            .section-tabs {
                gap: 5px;
            }

            .section-tab {
                font-size: 0.8rem;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav>
            <a href="/">ğŸ  í™ˆ</a>
            <a href="/semiconductor">ğŸ”¬ ë°˜ë„ì²´</a>
            <a href="/laborlaw">âš–ï¸ ë…¸ë™ë²•</a>
            <a href="/msds" class="current">{{ config.icon }} MSDS</a>
        </nav>

        <!-- Header -->
        <header>
            <h1>{{ config.icon }} {{ config.title }}</h1>
            <p>{{ config.description }}</p>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Search Panel -->
            <div class="search-panel">
                <h2>ğŸ” í™”í•™ë¬¼ì§ˆ ê²€ìƒ‰</h2>
                <form class="search-form" id="searchForm">
                    <div class="form-group">
                        <label for="searchWord">ê²€ìƒ‰ì–´</label>
                        <input type="text" id="searchWord" name="searchWord" placeholder="ì˜ˆ: ë²¤ì  , ì—íƒ„ì˜¬" required>
                    </div>

                    <div class="form-group">
                        <label for="searchType">ê²€ìƒ‰ ìœ í˜•</label>
                        <select id="searchType" name="searchType">
                            <option value="0">êµ­ë¬¸ëª…</option>
                            <option value="1">CAS ë²ˆí˜¸</option>
                            <option value="2">UN ë²ˆí˜¸</option>
                            <option value="3">KE ë²ˆí˜¸</option>
                            <option value="4">ì˜ë¬¸ëª…</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-search" id="btnSearch">ê²€ìƒ‰</button>
                </form>

                <!-- Camera Section -->
                <div class="camera-section">
                    <button type="button" class="btn-camera" id="btnOpenCamera">
                        ğŸ“· ì¹´ë©”ë¼ë¡œ í™”í•™ë¬¼ì§ˆ ì¸ì‹
                    </button>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="results-panel">
                <div class="results-header">
                    <h2>ê²€ìƒ‰ ê²°ê³¼</h2>
                    <span class="result-count" id="resultCount"></span>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-icon">ğŸ§ª</div>
                    <p>í™”í•™ë¬¼ì§ˆ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                </div>

                <!-- Loading State -->
                <div class="loading" id="loadingState" style="display: none;">
                    ê²€ìƒ‰ ì¤‘
                </div>

                <!-- Search Results Container -->
                <div id="searchResultsContainer" style="display: none;">
                    <!-- Selected Result -->
                    <div class="search-results" id="selectedResult"></div>

                    <!-- Detail View -->
                    <div class="detail-view" id="detailView">
                        <div class="detail-header" id="detailHeader"></div>

                        <!-- Summary Section -->
                        <div class="summary-section" id="summarySection"></div>

                        <!-- Detail Sections -->
                        <div class="detail-sections">
                            <h4>ğŸ“‹ ì „ì²´ ìƒì„¸ ì •ë³´</h4>
                            <div id="accordionContainer"></div>
                        </div>
                    </div>

                    <!-- Other Results -->
                    <div class="other-results" id="otherResults">
                        <div class="other-results-header">ğŸ’¡ ë‹¤ë¥¸ ê²€ìƒ‰ ê²°ê³¼</div>
                        <div class="search-results" id="otherResultsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Camera Modal -->
        <div class="camera-modal" id="cameraModal">
            <div class="camera-container">
                <div class="camera-header">
                    <h3>ğŸ“· í™”í•™ë¬¼ì§ˆ ì¹´ë©”ë¼ ì¸ì‹</h3>
                    <button class="btn-close" id="btnCloseCamera">Ã—</button>
                </div>

                <div class="camera-view">
                    <video id="videoElement" autoplay playsinline></video>
                    <canvas id="canvasElement"></canvas>
                </div>

                <div class="camera-controls">
                    <button class="btn-capture" id="btnCapture">ì‚¬ì§„ ì´¬ì˜</button>
                    <button class="btn-retake" id="btnRetake" style="display: none;">ë‹¤ì‹œ ì´¬ì˜</button>
                    <button class="btn-identify" id="btnIdentify" style="display: none;">í™”í•™ë¬¼ì§ˆ ì¸ì‹</button>
                </div>

                <div class="camera-status" id="cameraStatus"></div>
            </div>
        </div>
    </div>

    <script>
        const searchForm = document.getElementById('searchForm');
        const searchResultsContainer = document.getElementById('searchResultsContainer');
        const selectedResult = document.getElementById('selectedResult');
        const otherResultsList = document.getElementById('otherResultsList');
        const emptyState = document.getElementById('emptyState');
        const loadingState = document.getElementById('loadingState');
        const detailView = document.getElementById('detailView');
        const resultCount = document.getElementById('resultCount');

        let currentResults = [];
        let currentDetail = null;
        let selectedChemId = null;

        // MSDS Section Names
        const SECTION_NAMES = {
            '01': 'í™”í•™ì œí’ˆê³¼ íšŒì‚¬ ì •ë³´',
            '02': 'ìœ í•´ì„±Â·ìœ„í—˜ì„±',
            '03': 'êµ¬ì„±ì„±ë¶„ ë° í•¨ìœ ëŸ‰',
            '04': 'ì‘ê¸‰ì¡°ì¹˜ìš”ë ¹',
            '05': 'í­ë°œÂ·í™”ì¬ì‹œ ëŒ€ì²˜',
            '06': 'ëˆ„ì¶œì‚¬ê³ ì‹œ ëŒ€ì²˜',
            '07': 'ì·¨ê¸‰ ë° ì €ì¥ë°©ë²•',
            '08': 'ë…¸ì¶œë°©ì§€ ë° ë³´í˜¸êµ¬',
            '09': 'ë¬¼ë¦¬í™”í•™ì  íŠ¹ì„±',
            '10': 'ì•ˆì •ì„± ë° ë°˜ì‘ì„±',
            '11': 'ë…ì„± ì •ë³´',
            '12': 'í™˜ê²½ ì˜í–¥',
            '13': 'íê¸°ì‹œ ì£¼ì˜ì‚¬í•­',
            '14': 'ìš´ì†¡ ì •ë³´',
            '15': 'ë²•ì  ê·œì œí˜„í™©',
            '16': 'ê¸°íƒ€ ì°¸ê³ ì‚¬í•­'
        };

        // Search Form Submit
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const searchWord = document.getElementById('searchWord').value.trim();
            const searchType = document.getElementById('searchType').value;

            if (!searchWord) return;

            // Show loading
            emptyState.style.display = 'none';
            searchResultsContainer.style.display = 'none';
            loadingState.style.display = 'block';
            detailView.classList.remove('active');

            try {
                const response = await fetch('/api/msds/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        search_word: searchWord,
                        search_type: parseInt(searchType),
                        page_no: 1,
                        num_of_rows: 20
                    })
                });

                const data = await response.json();

                if (data.success && data.items && data.items.length > 0) {
                    currentResults = data.items;
                    displayResults(data.items);
                    resultCount.textContent = `${data.totalCount}ê°œ ë°œê²¬`;
                } else {
                    showEmptyResults();
                }
            } catch (error) {
                console.error('Search error:', error);
                showEmptyResults();
            } finally {
                loadingState.style.display = 'none';
            }
        });

        // Display Search Results (Initial display - all results as cards)
        function displayResults(items) {
            // Show initial results as clickable cards
            selectedResult.innerHTML = '';
            otherResultsList.innerHTML = '';
            detailView.classList.remove('active');

            // Display all results
            const container = document.createElement('div');
            container.style.display = 'flex';
            container.style.flexDirection = 'column';
            container.style.gap = '15px';

            items.forEach((item, index) => {
                const div = createResultCard(item);
                div.onclick = () => loadDetail(item.chemId, item);
                container.appendChild(div);
            });

            selectedResult.appendChild(container);
            searchResultsContainer.style.display = 'block';
        }

        // Create Result Card
        function createResultCard(item) {
            const div = document.createElement('div');
            div.className = 'result-item';
            div.innerHTML = `
                <div class="result-name">${item.prodNmKor || item.chemNmKor || 'í™”í•™ë¬¼ì§ˆëª… ì—†ìŒ'}</div>
                <div class="result-info">
                    ${item.casNo ? `<span>CAS: ${item.casNo}</span>` : ''}
                    ${item.unNo ? `<span>UN: ${item.unNo}</span>` : ''}
                    ${item.keNo ? `<span>KE: ${item.keNo}</span>` : ''}
                </div>
            `;
            return div;
        }

        // Load Chemical Detail
        async function loadDetail(chemId, selectedItem) {
            selectedChemId = chemId;

            // Show loading
            detailView.classList.remove('active');
            loadingState.style.display = 'block';

            // Scroll to top of results panel
            document.getElementById('searchResultsContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });

            try {
                const response = await fetch('/api/msds/detail', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chem_id: chemId })
                });

                const data = await response.json();

                if (data.success && data.sections) {
                    currentDetail = data;

                    // Reorganize layout: Selected item -> Detail -> Other results
                    reorganizeResults(selectedItem);
                    displayDetail(data);
                }
            } catch (error) {
                console.error('Detail error:', error);
            } finally {
                loadingState.style.display = 'none';
            }
        }

        // Reorganize Results Layout
        function reorganizeResults(selectedItem) {
            // Clear containers
            selectedResult.innerHTML = '';
            otherResultsList.innerHTML = '';

            // Show selected item at the top
            const selectedCard = createResultCard(selectedItem);
            selectedCard.classList.add('selected');
            selectedResult.appendChild(selectedCard);

            // Show other results below
            const otherItems = currentResults.filter(item => item.chemId !== selectedItem.chemId);
            if (otherItems.length > 0) {
                otherItems.forEach(item => {
                    const card = createResultCard(item);
                    card.onclick = () => loadDetail(item.chemId, item);
                    otherResultsList.appendChild(card);
                });
                document.getElementById('otherResults').style.display = 'block';
            } else {
                document.getElementById('otherResults').style.display = 'none';
            }
        }

        // Display Chemical Detail
        function displayDetail(data) {
            const firstSection = Object.values(data.sections)[0];
            const firstItem = firstSection?.items?.[0] || {};

            // Header
            document.getElementById('detailHeader').innerHTML = `
                <h3>${firstItem.prodNmKor || firstItem.chemNmKor || 'í™”í•™ë¬¼ì§ˆ ì •ë³´'}</h3>
                <div class="detail-meta">
                    ${firstItem.casNo ? `<span>CAS: ${firstItem.casNo}</span>` : ''}
                    ${firstItem.unNo ? `<span>UN: ${firstItem.unNo}</span>` : ''}
                    ${firstItem.keNo ? `<span>KE: ${firstItem.keNo}</span>` : ''}
                </div>
            `;

            // Create Summary Section
            createSummarySection(data);

            // Create Accordion for all sections
            createAccordion(data);

            detailView.classList.add('active');
        }

        // Create Summary Section
        function createSummarySection(data) {
            const summarySection = document.getElementById('summarySection');

            // Extract key information
            const section01 = data.sections['01']; // í™”í•™ì œí’ˆ ì •ë³´
            const section02 = data.sections['02']; // ìœ í•´ì„±Â·ìœ„í—˜ì„±
            const section07 = data.sections['07']; // ì·¨ê¸‰ ë° ì €ì¥
            const section11 = data.sections['11']; // ë…ì„±
            const section04 = data.sections['04']; // ì‘ê¸‰ì¡°ì¹˜
            const section05 = data.sections['05']; // í­ë°œÂ·í™”ì¬
            const section06 = data.sections['06']; // ëˆ„ì¶œì‚¬ê³ 

            let summaryHTML = '<div class="summary-grid">';

            // í™”í•™ë¬¼ì§ˆëª… ë° CAS
            if (section01) {
                const item = section01.items?.[0] || {};
                summaryHTML += `
                    <div class="summary-card">
                        <div class="summary-card-title">ğŸ§ª í™”í•™ë¬¼ì§ˆ ê¸°ë³¸ ì •ë³´</div>
                        <div class="summary-card-content">
                            <strong>ì œí’ˆëª…:</strong> ${item.prodNmKor || item.chemNmKor || '-'}
                            ${item.casNo ? `<strong>CAS ë²ˆí˜¸:</strong> ${item.casNo}` : ''}
                            ${item.keNo ? `<strong>KE ë²ˆí˜¸:</strong> ${item.keNo}` : ''}
                            ${item.unNo ? `<strong>UN ë²ˆí˜¸:</strong> ${item.unNo}` : ''}
                        </div>
                    </div>
                `;
            }

            // ìœ í•´ì„± ë° ë…ì„±
            summaryHTML += `
                <div class="summary-card">
                    <div class="summary-card-title">âš ï¸ ìœ í•´ì„± ë° ë…ì„± ì •ë³´</div>
                    <div class="summary-card-content">
                        ${getSectionSummary(section02, 'ìœ í•´ì„±Â·ìœ„í—˜ì„±')}
                        ${getSectionSummary(section11, 'ë…ì„± ì •ë³´')}
                    </div>
                </div>
            `;

            // ì·¨ê¸‰ ë° ì €ì¥
            if (section07) {
                summaryHTML += `
                    <div class="summary-card">
                        <div class="summary-card-title">ğŸ“¦ ì·¨ê¸‰ ë° ì €ì¥ ì •ë³´</div>
                        <div class="summary-card-content">
                            ${getSectionSummary(section07, null)}
                        </div>
                    </div>
                `;
            }

            summaryHTML += '</div>';

            // ì‘ê¸‰ ëŒ€ì²˜ ì •ë³´ (ì „ì²´ ë„ˆë¹„ë¡œ ê°•ì¡°)
            summaryHTML += '<div class="summary-highlight">';
            summaryHTML += '<div class="summary-card-title">ğŸš¨ ëˆ„ì¶œì‚¬ê³ ì‹œ/í­ë°œì‹œ ì‘ê¸‰ ëŒ€ì²˜</div>';
            summaryHTML += '<div class="summary-card-content">';
            summaryHTML += getSectionSummary(section04, 'ì‘ê¸‰ì¡°ì¹˜ìš”ë ¹');
            summaryHTML += getSectionSummary(section05, 'í­ë°œÂ·í™”ì¬ì‹œ ëŒ€ì²˜');
            summaryHTML += getSectionSummary(section06, 'ëˆ„ì¶œì‚¬ê³ ì‹œ ëŒ€ì²˜');
            summaryHTML += '</div></div>';

            summarySection.innerHTML = summaryHTML;
        }

        // Get Section Summary (first 3 items)
        function getSectionSummary(section, title) {
            if (!section || !section.items || section.items.length === 0) {
                return '';
            }

            let html = '';
            if (title) {
                html += `<strong>${title}:</strong><br>`;
            }

            const maxItems = 3;
            section.items.slice(0, maxItems).forEach(item => {
                if (item.itemDetail && item.itemDetail.trim()) {
                    const detail = item.itemDetail.length > 200
                        ? item.itemDetail.substring(0, 200) + '...'
                        : item.itemDetail;
                    html += `${detail}<br><br>`;
                }
            });

            return html || 'ì •ë³´ ì—†ìŒ';
        }

        // Create Accordion for all sections
        function createAccordion(data) {
            const container = document.getElementById('accordionContainer');
            container.innerHTML = '';

            Object.keys(data.sections).forEach(sectionCode => {
                const section = data.sections[sectionCode];
                const sectionName = SECTION_NAMES[sectionCode] || `ì„¹ì…˜ ${sectionCode}`;

                const accordionItem = document.createElement('div');
                accordionItem.className = 'accordion-item';

                // Accordion Header
                const header = document.createElement('div');
                header.className = 'accordion-header';
                header.innerHTML = `
                    <span class="accordion-title">${sectionName}</span>
                    <span class="accordion-icon">â–¼</span>
                `;

                // Accordion Content
                const content = document.createElement('div');
                content.className = 'accordion-content';

                const body = document.createElement('div');
                body.className = 'accordion-body';

                if (section.items && section.items.length > 0) {
                    section.items.forEach(item => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'section-item';
                        itemDiv.innerHTML = `
                            <div class="section-item-name">${item.msdsItemNameKor || ''}</div>
                            <div class="section-item-detail">${item.itemDetail || 'ì •ë³´ ì—†ìŒ'}</div>
                        `;
                        body.appendChild(itemDiv);
                    });
                } else {
                    body.innerHTML = '<div style="text-align: center; color: #888;">ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                }

                content.appendChild(body);

                // Toggle accordion
                header.onclick = () => {
                    const isActive = header.classList.contains('active');

                    // Close all accordions
                    document.querySelectorAll('.accordion-header').forEach(h => {
                        h.classList.remove('active');
                    });
                    document.querySelectorAll('.accordion-content').forEach(c => {
                        c.classList.remove('active');
                    });

                    // Open clicked accordion if it was closed
                    if (!isActive) {
                        header.classList.add('active');
                        content.classList.add('active');
                    }
                };

                accordionItem.appendChild(header);
                accordionItem.appendChild(content);
                container.appendChild(accordionItem);
            });
        }

        // Show Empty Results
        function showEmptyResults() {
            searchResultsContainer.style.display = 'none';
            emptyState.style.display = 'block';
            emptyState.innerHTML = `
                <div class="empty-state-icon">ğŸ”</div>
                <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            `;
            resultCount.textContent = '';
        }

        // ===== Camera Functionality =====
        const cameraModal = document.getElementById('cameraModal');
        const btnOpenCamera = document.getElementById('btnOpenCamera');
        const btnCloseCamera = document.getElementById('btnCloseCamera');
        const videoElement = document.getElementById('videoElement');
        const canvasElement = document.getElementById('canvasElement');
        const btnCapture = document.getElementById('btnCapture');
        const btnRetake = document.getElementById('btnRetake');
        const btnIdentify = document.getElementById('btnIdentify');
        const cameraStatus = document.getElementById('cameraStatus');

        let stream = null;
        let capturedImageData = null;

        // Open Camera
        btnOpenCamera.addEventListener('click', async () => {
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                videoElement.srcObject = stream;
                cameraModal.classList.add('active');
                videoElement.style.display = 'block';
                canvasElement.style.display = 'none';
                btnCapture.style.display = 'inline-block';
                btnRetake.style.display = 'none';
                btnIdentify.style.display = 'none';
                cameraStatus.textContent = 'í™”í•™ë¬¼ì§ˆ ë¼ë²¨ì´ë‚˜ ìš©ê¸°ë¥¼ ì¹´ë©”ë¼ì— ë¹„ì¶°ì£¼ì„¸ìš”';
                cameraStatus.className = 'camera-status';
            } catch (error) {
                alert('ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤: ' + error.message);
            }
        });

        // Close Camera
        btnCloseCamera.addEventListener('click', () => {
            stopCamera();
            cameraModal.classList.remove('active');
        });

        // Stop Camera Stream
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        }

        // Capture Photo
        btnCapture.addEventListener('click', () => {
            const context = canvasElement.getContext('2d');
            canvasElement.width = videoElement.videoWidth;
            canvasElement.height = videoElement.videoHeight;
            context.drawImage(videoElement, 0, 0);

            // Show canvas, hide video
            videoElement.style.display = 'none';
            canvasElement.style.display = 'block';

            // Update buttons
            btnCapture.style.display = 'none';
            btnRetake.style.display = 'inline-block';
            btnIdentify.style.display = 'inline-block';

            // Get image data
            capturedImageData = canvasElement.toDataURL('image/jpeg', 0.8);
            cameraStatus.textContent = 'ì‚¬ì§„ì´ ì´¬ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. "í™”í•™ë¬¼ì§ˆ ì¸ì‹" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
            cameraStatus.className = 'camera-status';
        });

        // Retake Photo
        btnRetake.addEventListener('click', () => {
            videoElement.style.display = 'block';
            canvasElement.style.display = 'none';
            btnCapture.style.display = 'inline-block';
            btnRetake.style.display = 'none';
            btnIdentify.style.display = 'none';
            capturedImageData = null;
            cameraStatus.textContent = 'í™”í•™ë¬¼ì§ˆ ë¼ë²¨ì´ë‚˜ ìš©ê¸°ë¥¼ ì¹´ë©”ë¼ì— ë¹„ì¶°ì£¼ì„¸ìš”';
            cameraStatus.className = 'camera-status';
        });

        // Identify Chemical
        btnIdentify.addEventListener('click', async () => {
            if (!capturedImageData) {
                alert('ë¨¼ì € ì‚¬ì§„ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                cameraStatus.textContent = 'í™”í•™ë¬¼ì§ˆ ì¸ì‹ ì¤‘...';
                cameraStatus.className = 'camera-status identifying';
                btnIdentify.disabled = true;

                const response = await fetch('/api/msds/identify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: capturedImageData })
                });

                const data = await response.json();

                if (data.success && data.search_result && data.search_result.success) {
                    cameraStatus.textContent = `âœ… "${data.identified.chemical_name}" ì¸ì‹ ì™„ë£Œ!`;

                    // Close camera modal
                    stopCamera();
                    cameraModal.classList.remove('active');

                    // Display search results
                    if (data.search_result.items && data.search_result.items.length > 0) {
                        currentResults = data.search_result.items;
                        displayResults(data.search_result.items);
                        resultCount.textContent = `${data.search_result.totalCount}ê°œ ë°œê²¬`;

                        // Show notification
                        emptyState.style.display = 'block';
                        emptyState.innerHTML = `
                            <div class="empty-state-icon">âœ…</div>
                            <p>"${data.identified.chemical_name}" ê²€ìƒ‰ ì™„ë£Œ</p>
                        `;
                        setTimeout(() => {
                            emptyState.style.display = 'none';
                        }, 2000);
                    } else {
                        showEmptyResults();
                    }
                } else {
                    cameraStatus.textContent = 'âŒ ' + (data.error || 'í™”í•™ë¬¼ì§ˆì„ ì¸ì‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    cameraStatus.className = 'camera-status';
                }
            } catch (error) {
                cameraStatus.textContent = 'âŒ ì¸ì‹ ì‹¤íŒ¨: ' + error.message;
                cameraStatus.className = 'camera-status';
            } finally {
                btnIdentify.disabled = false;
            }
        });

        // Close modal on outside click
        cameraModal.addEventListener('click', (e) => {
            if (e.target === cameraModal) {
                stopCamera();
                cameraModal.classList.remove('active');
            }
        });
    </script>
</body>
</html>
